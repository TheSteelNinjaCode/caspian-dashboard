<!-- @import { AlertDialog, Button, ButtonGroup, Dialog, Field, Input, Label, Table } from ../../../lib/maddex -->
<!-- @import { Pencil, Plus, Trash } from ../../../lib/ppicons -->
<!-- @import { CreateUpdateDialog, DeleteDialog } from ../../components/dashboard/users -->
<!-- @import { AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from ../../../lib/maddex/AlertDialog.py -->
<!-- @import { DialogClose, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from ../../../lib/maddex/Dialog.py -->
<!-- @import FieldGroup from ../../../lib/maddex/Field.py -->
<!-- @import { TableBody, TableCaption, TableCell, TableHead, TableHeader, TableRow } from ../../../lib/maddex/Table.py -->

<header class="mb-6 flex items-center justify-between">
  <h2 class="text-2xl font-bold tracking-tight">Users</h2>
  <div>
    <Button onclick="newUser()">
    <Plus class="size-4" />
    </Button>
  </div>
</header>

<Table>
  <TableCaption>A list of your recent users.</TableCaption>
  <TableHeader>
    <TableRow>
      <TableHead>Name</TableHead>
      <TableHead>Email</TableHead>
      <TableHead>Created at</TableHead>
      <TableHead>Options</TableHead>
    </TableRow>
  </TableHeader>
  <TableBody>
    <template pp-for="user in users">
      <TableRow>
        <TableCell class="font-medium">{user.name}</TableCell>
        <TableCell>{user.email}</TableCell>
        <TableCell>{formatDate(user.createdAt)}</TableCell>
        <TableCell>
            <ButtonGroup>
                <Button variant="outline" size="icon" onclick="editUser(user)">
                    <Pencil class="size-4" />
                </Button>
                <Button variant="destructive" size="icon" onclick="deleteUser(user)">
                    <Trash class="size-4" />
                </Button>
            </ButtonGroup>
        </TableCell>
      </TableRow>
    </template>
  </TableBody>
</Table>

<CreateUpdateDialog openDialog="{openCreateUpdateDialog}" setOpenDialog="{setOpenCreateUpdateDialog}" selectedUser="{selectedUser}" users="{users}" setUsers="{setUsers}" />
<DeleteDialog openDialog="{openAlertDialog}" setOpenDialog="{setOpenAlertDialog}" selectedUser="{selectedUser}" users="{users}" setUsers="{setUsers}" />

<script>
  const usersJson = [[users | json]];
  const [users, setUsers] = pp.state(usersJson);
  const [openCreateUpdateDialog, setOpenCreateUpdateDialog] = pp.state(false);
  const [openAlertDialog, setOpenAlertDialog] = pp.state(false);
  const [selectedUser, setSelectedUser] = pp.state(null);

  function formatDate(dateString) {
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return new Date(dateString).toLocaleDateString(undefined, options);
  }

  function newUser() {
    setSelectedUser(null);
    setOpenCreateUpdateDialog(true);
  }

  function editUser(user) {
    console.log("Edit user:", user);
    setSelectedUser(user);
    setOpenCreateUpdateDialog(true);
  }

  function deleteUser(user) {
    console.log("Delete user:", user);
    setSelectedUser(user);
    setOpenAlertDialog(true);
  }
</script>