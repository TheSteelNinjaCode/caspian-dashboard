<aside class="row-start-2 bg-card border border-border rounded-xl flex flex-col overflow-y-auto overflow-x-hidden w-full">
  <div class="p-3 sm:p-4 space-y-6">

    <div class="px-2 pb-2 border-b border-border/60">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-semibold leading-none">Brand</p>
          <p class="text-xs text-muted-foreground mt-1">Description</p>
        </div>
      </div>
    </div>

    <template pp-for="section in sidebarSections">
      <div>
        <h3 class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2 px-2">
          {section.title}
        </h3>

        <nav class="space-y-1">
          <template pp-for="item in section.items">

            <!-- Item -->
            <a
              href="{item.href}"
              class="group flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors w-full
                {isActive(item.href) ? 'bg-accent text-accent-foreground' : 'text-muted-foreground hover:bg-accent/50 hover:text-accent-foreground'}"
            >
              <item.icon class="size-4 shrink-0" hidden="{!item.icon}" />

              <span class="truncate flex-1">{item.name}</span>

              <!-- Badge -->
              <span
                hidden="{!item.badge}"
                class="shrink-0 rounded-full px-2 py-0.5 text-[11px] font-semibold border
                  {badgeClass(item.badge)}"
              >
                {item.badge?.label}
              </span>
            </a>

            <!-- Children (indented, no dropdown) -->
            <div hidden="{!item.children || item.children.length === 0}" class="mt-1 ml-3 pl-3 border-l border-border/70 space-y-1">
              <template pp-for="child in item.children">
                <a
                  href="{child.href}"
                  class="group flex items-center gap-3 px-3 py-2 text-sm rounded-lg transition-colors w-full
                    {isActive(child.href) ? 'bg-accent text-accent-foreground' : 'text-muted-foreground hover:bg-accent/50 hover:text-accent-foreground'}"
                >
                  <child.icon class="size-4 shrink-0" hidden="{!child.icon}" />
                  <span class="truncate flex-1">{child.name}</span>
                </a>
              </template>
            </div>

          </template>
        </nav>
      </div>
    </template>

  </div>

  <script>
    const sidebarSectionsJson = [[sidebar_sections | json]];
    const [sidebarSections, setSidebarSections] = pp.state(sidebarSectionsJson);
    const [currentUrl, setCurrentUrl] = pp.state(window.location.pathname);

    function isActive(href) {
      if (!href || href === "#") return false;
      if (href === "/dashboard") return currentUrl === "/dashboard";
      return currentUrl === href || currentUrl.startsWith(href + "/");
    }

    // Badge tones (token-safe)
    function badgeClass(badge) {
      const tone = badge?.tone || "muted";
      if (tone === "ok") return "bg-secondary text-foreground border-border";
      if (tone === "warn") return "bg-secondary text-foreground border-border";
      return "bg-secondary text-muted-foreground border-border";
    }

    window.addEventListener("popstate", () => setCurrentUrl(window.location.pathname));
  </script>
</aside>
